<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" type="text/css" href="tankstyle.css">
  <title>Tank - Game</title>
</head>
<body>
  <div id="start-menu">
    <h1 id = "logo">Codename: Tanks</h1>
    <button type="button" onclick="playGame()" id="buttons"> Start game</button>
    <button type="button" onclick="openSettings()" id="buttons"> Options</button>
    <!--<button type="button" onclick="muteAudio()" id="buttons"> Mute audio</button>-->
    <button type="button" onclick="quitGame()" id="buttons"> Quit</button>
  
    </div>

    
    <div id="options-menu">
      <div id="music-controls">
          <h2>Music volume</h2>
        <input type="range" id="volume-slider" min="0" max="0.5" step="0.1" value="1">
      </div>
      <audio id="game-audio" loop>
        <source src="audio/tankgame-maintheme.wav" type="audio/wav">
      </audio>
      <button type="button" onclick="starerMenu()" id="buttons"> Back</button>

    </div>
  <canvas id="gameCanvas" width="500" height="500"></canvas>


  <script>
    const canvas = document.getElementById("gameCanvas");
    canvas.width = 1300
    canvas.height = 900
    const ctx = canvas.getContext("2d");
    const gameAudio = document.getElementById("game-audio");
    const volumeSlider = document.getElementById("volume-slider");
    const startMenu = document.getElementById("start-menu");
    const optionMenu = document.getElementById("options-menu");

    volumeSlider.addEventListener("input", () => {
      gameAudio.volume = volumeSlider.value;
    });
    volumeSlider.style.display = "none";
    optionMenu.style.display = "none";


 


    // Play the audio file
    gameAudio.play();
    gameAudio.volume = 0.5;
    gameAudio.loop = true;

//
    let playerX = 250;
    let playerY = 250;
    let playerSpeed = 0; 
    let playerAngle = 0;
    let mouseX = 0;
    let mouseY = 0;

    function drawPlayerTank() {
      ctx.save();
      ctx.translate(playerX, playerY);
      ctx.rotate(playerAngle);
      ctx.fillStyle = "gray";
      ctx.fillRect(-10, -15, 20, 30);
      ctx.fillRect(-15, -10, 30, 20);
      ctx.restore();
    }

        let left = false
        let right = false
        let up = false
        let down = false

        document.addEventListener("keydown", event => {
          if (event.key === "a") { left = true }
          if (event.key === "d") { right = true }
          if (event.key === "w") { up = true } 
          if (event.key === "s") { down = true }

        })
        document.addEventListener("keyup", event => {
          if (event.key === "a") { left = false }
          if (event.key === "d") { right = false }
          if (event.key === "w") { up = false }
          if (event.key === "s") { down = false }


        })

        // add event listener to game canvas element
canvas.addEventListener('mousedown', shootProjectile);

// function to handle left mouse click event
function shootProjectile(event) {
  if (event.button === 0) { // left mouse button
    // get current tank position
    let tankX = playerX;
    let tankY = playerY;

    // create new projectile object
    let projectile = {
      x: tankX,
      y: tankY,
      velocityX: 10, // adjust this value to change projectile speed
      velocityY: 0, // adjust this value to change projectile trajectory
      radius: 5, // adjust this value to change projectile size
    };

    // add new projectile object to array
    projectiles.push(projectile);
  }
}

// game update loop
function update() {
  // update position of each projectile object
  for (let i = 0; i < projectiles.length; i++) {
    let projectile = projectiles[i];
    projectile.x += projectile.velocityX;
    projectile.y += projectile.velocityY;

    // check for collisions with other game objects
    // (code not shown)

    // remove off-screen or collided projectile objects
    if (projectile.x < 0 || projectile.x > canvas.width ||
        projectile.y < 0 || projectile.y > canvas.height) {
      projectiles.splice(i, 1);
      i--;
    }
  }
}




    function updatePlayerTank() {
      let dx = mouseX - playerX;
      let dy = mouseY - playerY;
      playerAngle = Math.atan2(dy, dx);
      playerX += Math.cos(playerAngle) * playerSpeed;
      playerY += Math.sin(playerAngle) * playerSpeed;
    }

    function tankMovement() {
      if (right) {
          playerX++
      }
      if (left) {
          playerX--
      }
      if (up) {
          playerY--
      }
      if (down) {
          playerY++
      }

    }

    canvas.onmousemove = function(event) {
      mouseX = event.clientX;
      mouseY = event.clientY;
    };

   

    // game loop
    function gameLoop() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      updatePlayerTank();
      drawPlayerTank();
      tankMovement()
      update()
      shootProjectile()
      requestAnimationFrame(gameLoop);
    }

    function starerMenu() {
      startMenu.style.display = "block"
      optionMenu.style.display = "none";
      volumeSlider.style.display = "none";

    }

    function openSettings() {
      console.log("åpner settings...");
      startMenu.style.display = "none";
      optionMenu.style.display = "block";
      volumeSlider.style.display = "block";
    }

    function quitGame() {
      console.log("Går ut av spillet....")
      
    }
    function muteAudio() {
      gameAudio.pause();
    }


    function playGame() {
      startMenu.style.display = "none"

      gameLoop()
    }



    
  </script>
  </body>
</html>
